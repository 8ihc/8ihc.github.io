<!DOCTYPE html>
<html lang="zh-TW">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>慢性下背痛的醫療花費 - Assignment 07</title>
	
	<!-- Bootstrap 5 CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	
	<style>
		/* ========================================
		   全域樣式設定
		   ======================================== */
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			overflow-x: hidden; /* 防止水平溢出 */
		}

		/* ========================================
		   1. 進度條效果 (Progress Bar)
		   - 背景：手寫圖片 (hand_writing.png)
		   - 覆蓋層：漸層色彩 (深紅→靛紫→暗紫)
		   - 高度：300vh (讓使用者慢慢捲動)
		   ======================================== */
		.image-transition-container {
			height: 300vh; /* 捲動 3 個視窗高度 */
		}

		#outer {
			background-image: url(images/hand_writing.png);
			background-size: 20%; /* 縮小到 20% */
			background-repeat: no-repeat;
			background-attachment: fixed; /* 固定背景 */
			background-position: center;
			background-color: #ffffff; /* 白色底色 */
		}

		#statusbar {
			width: 0; /* 初始寬度為 0，透過 JavaScript 控制 */
			height: 100vh;
			background: linear-gradient(135deg, 
				#8B0000 0%,    /* 深紅色 (痛苦的開始) */
				#4B0082 50%,   /* 靛紫色 (治療的混亂) */
				#2F1B3C 100%   /* 暗紫色 (無盡的花費) */
			);
			opacity: 0.85; /* 半透明，讓底圖若隱若現 */
		}

		/* ========================================
		   2. 水平捲動區域 (Horizontal Scroll)
		   - 效果：垂直捲動觸發水平移動
		   - 圖片：01.png, 02.png, 03.png
		   - 寬度：300vw (3 個畫面寬度)
		   ======================================== */
		.scroll-container {
			height: 1000vh; /* 讓垂直捲動區域夠長以觸發水平捲動效果 */
			position: relative;
		}

		.horizontal-section {
			position: sticky; /* 黏在視窗頂部 */
			top: 0;
			height: 100vh;
			width: 300vw; /* 3 個 100vw 的區塊 */
			display: flex;
			flex-direction: row;
			transition: transform 0.1s linear; /* 平滑移動效果 */
		}

		.horizontal-item {
			width: 100vw; /* 每個區塊佔滿一個視窗寬度 */
			height: 100vh;
			flex-shrink: 0; /* 防止壓縮 */
			display: flex;
			justify-content: center;
			align-items: center;
			background-color: #ffffff; 
			position: relative; /* 讓便條紙可以絕對定位 */
			overflow: hidden; /* 防止便條紙超出範圍 */
		}

		.horizontal-item img {
			max-width: 90vw; /* 最大寬度 90% 視窗寬度 */
			height: 100vh; /* 高度佔滿視窗 */
			object-fit: contain; /* 保持圖片比例 */
			position: relative;
			z-index: 1; /* 在便條紙下方 */
		}

		/* ========================================
		   3. 便條紙效果 (Sticky Notes)
		   - 來源：整合自 test.html
		   - 效果：漫畫風格邊框 + 網點背景
		   - 位置：只出現在第一張圖片上
		   - 動畫：透過 JavaScript 逐一顯示
		   ======================================== */
		.sticky-note {
			position: absolute;
			width: 200px;
			padding: 20px;
			background: white;
			border: 3px solid black; /* 粗黑框 */
			box-shadow: 5px 5px 0 rgba(0,0,0,0.3); /* 漫畫風格陰影 */
			font-size: 16px;
			line-height: 1.6;
			opacity: 0; /* 初始隱藏 */
			transition: opacity 0.5s ease; /* 淡入效果 */
			z-index: 10; /* 在圖片上方 */
			/* 漫畫風格網點效果 */
			background-image: 
				repeating-linear-gradient(
					0deg,
					transparent,
					transparent 2px,
					rgba(0,0,0,0.03) 2px,
					rgba(0,0,0,0.03) 4px
				);
		}

		/* 雙層邊框效果 */
		.sticky-note::before {
			content: '';
			position: absolute;
			top: -3px;
			left: -3px;
			right: -3px;
			bottom: -3px;
			border: 2px solid black;
			pointer-events: none;
		}

		/* 便條紙位置（歪歪的效果，模擬手工貼上） */
		.sticky-note:nth-child(2) { top: 15%; left: 10%; transform: rotate(-5deg); }
		.sticky-note:nth-child(3) { top: 20%; left: 35%; transform: rotate(3deg); }
		.sticky-note:nth-child(4) { top: 12%; left: 65%; transform: rotate(-8deg); }
		.sticky-note:nth-child(5) { top: 45%; left: 15%; transform: rotate(6deg); }
		.sticky-note:nth-child(6) { top: 50%; left: 45%; transform: rotate(-3deg); }
		.sticky-note:nth-child(7) { top: 48%; left: 72%; transform: rotate(4deg); }
		.sticky-note:nth-child(8) { top: 72%; left: 8%; transform: rotate(-6deg); }
		.sticky-note:nth-child(9) { top: 75%; left: 38%; transform: rotate(7deg); }
		.sticky-note:nth-child(10) { top: 68%; left: 68%; transform: rotate(-4deg); }
		.sticky-note:nth-child(11) { top: 80%; left: 50%; transform: rotate(5deg); }

		/* 顯示狀態 */
		.sticky-note.visible {
			opacity: 1;
		}

		/* ========================================
		   4. 導覽列 (Navigation Bar)
		   - 來源：整合自 as06
		   - 功能：漢堡選單 + 首頁連結
		   - 位置：左上角固定
		   - 效果：毛玻璃背景 + 滑出選單
		   ======================================== */
		.navbar {
			position: fixed;
			top: 20px;
			left: 20px;
			z-index: 300; /* 最高層級，永遠顯示在最上方 */
		}

		/* 漢堡按鈕樣式 */
		.hamburger {
			display: flex;
			flex-direction: column;
			justify-content: space-around;
			width: 45px;
			height: 45px;
			background: rgba(255, 255, 255, 0.5); /* 半透明白色 */
			backdrop-filter: blur(10px); /* 毛玻璃效果 */
			border: 1px solid rgba(0, 0, 0, 0.1);
			border-radius: 8px;
			cursor: pointer;
			padding: 10px;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			transition: all 0.3s ease;
			position: relative;
			z-index: 301;
		}

		.hamburger:hover {
			background: rgba(255, 255, 255, 0.7);
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
		}

		/* 漢堡按鈕的三條線 */
		.hamburger span {
			width: 25px;
			height: 3px;
			background: #333;
			border-radius: 2px;
			transition: all 0.3s ease;
			transform-origin: center;
		}

		/* 漢堡按鈕變成 X 的動畫 */
		.hamburger.active span:nth-child(1) {
			transform: translateY(9px) rotate(45deg);
		}

		.hamburger.active span:nth-child(2) {
			opacity: 0; /* 中間線消失 */
		}

		.hamburger.active span:nth-child(3) {
			transform: translateY(-9px) rotate(-45deg);
		}

		/* 導覽選單 (側邊滑出) */
		.nav-menu {
			position: fixed;
			top: 0;
			left: -100%; /* 初始隱藏在左側外 */
			width: 250px;
			height: 100vh;
			background: rgba(255, 255, 255, 0.85);
			backdrop-filter: blur(10px);
			display: flex;
			flex-direction: column;
			padding: 80px 0 20px 0;
			box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
			transition: left 0.3s ease; /* 滑動效果 */
			overflow-y: auto;
			z-index: 299;
		}

		.nav-menu.active {
			left: 0; /* 滑入畫面 */
		}

		/* 導覽連結樣式 */
		.nav-link {
			padding: 15px 30px;
			color: #333;
			text-decoration: none;
			font-size: 16px;
			font-weight: 700;
			transition: all 0.3s ease;
			border-left: 3px solid transparent;
		}

		.nav-link:hover {
			background: rgba(0, 0, 0, 0.05);
			border-left-color: #333; /* 左側出現黑色線條 */
			padding-left: 35px; /* 向右推移 */
		}

		.nav-link:active {
			background: rgba(0, 0, 0, 0.1);
		}

		/* ========================================
		   5. 響應式設計 (Responsive Web Design)
		   - 平板 (≤768px)
		   - 手機 (≤576px)
		   - 小手機 (≤400px)
		   ======================================== */
		
		/* 平板裝置 (768px 以下) */
		@media screen and (max-width: 768px) {
			/* Progress Bar 手寫圖片放大，讓手機更容易看清楚 */
			#outer {
				background-size: 40%;
			}

			/* 便條紙縮小以適應較小螢幕 */
			.sticky-note {
				width: 150px;
				padding: 15px;
				font-size: 14px;
				border: 2px solid black;
			}

			/* Footer 文字縮小 */
			.footer-text {
				font-size: 1.2rem !important;
				padding: 1.5rem !important;
			}
		}

		/* 手機裝置 (576px 以下) */
		@media screen and (max-width: 576px) {
			/* Progress Bar 手寫圖片再放大 */
			#outer {
				background-size: 60%;
			}

			/* 水平捲動區域調整 (減少捲動距離) */
			.scroll-container {
				height: 800vh;
			}

			/* 圖片高度調整，留空間給便條紙 */
			.horizontal-item img {
				max-width: 95vw;
				height: 80vh;
			}

			/* 便條紙進一步縮小 */
			.sticky-note {
				width: 120px;
				padding: 12px;
				font-size: 12px;
				line-height: 1.4;
			}

			/* 調整便條紙位置，避免超出螢幕或重疊 */
			.sticky-note:nth-child(2) { top: 10%; left: 5%; }
			.sticky-note:nth-child(3) { top: 15%; left: 30%; }
			.sticky-note:nth-child(4) { top: 10%; left: 60%; }
			.sticky-note:nth-child(5) { top: 35%; left: 8%; }
			.sticky-note:nth-child(6) { top: 40%; left: 35%; }
			.sticky-note:nth-child(7) { top: 38%; left: 65%; }
			.sticky-note:nth-child(8) { top: 65%; left: 5%; }
			.sticky-note:nth-child(9) { top: 70%; left: 32%; }
			.sticky-note:nth-child(10) { top: 65%; left: 62%; }
			.sticky-note:nth-child(11) { top: 85%; left: 35%; }

			/* Footer 文字再縮小 */
			.footer-text {
				font-size: 1rem !important;
				padding: 1rem !important;
				line-height: 1.6;
			}
		}

		/* 小手機裝置 (400px 以下) */
		@media screen and (max-width: 400px) {
			#outer {
				background-size: 70%;
			}

			.sticky-note {
				width: 100px;
				padding: 10px;
				font-size: 11px;
			}

			.footer-text {
				font-size: 0.9rem !important;
			}
		}
	</style>
</head>
<body>

	<!-- 導覽列 -->
	<nav class="navbar" id="navbar">
		<button class="hamburger" id="hamburger">
			<span></span>
			<span></span>
			<span></span>
		</button>
		<div class="nav-menu" id="navMenu">
			<a href="../index.html" class="nav-link">首頁</a>
		</div>
	</nav>

	<!-- Progress Bar區塊 -->
	<div class="image-transition-container">
		<div id="outer" class="sticky-top">
			<div id="statusbar"></div>
		</div>
	</div>

	<!-- ===== 水平捲動區域 (從左到右) ===== -->
	<div class="scroll-container">
		<div class="horizontal-section">
			<div class="horizontal-item">
				<img src="images/01.png" alt="Image 1">
				<!-- 便條紙 (from test.html) -->
				<div class="sticky-note">你要多鍛鍊核心</div>
				<div class="sticky-note">聽說針灸有效</div>
				<div class="sticky-note">是不是姿勢不良？</div>
				<div class="sticky-note">試試自費物理治療<br>可是一次要2000元</div>
				<div class="sticky-note">吃止痛消炎藥就好</div>
				<div class="sticky-note">皮拉提斯有效<br>可是上課也不便宜</div>
				<div class="sticky-note">換個乳膠床墊看看</div>
				<div class="sticky-note">聽說那家推拿很厲害</div>
				<div class="sticky-note">開刀一節椎間盤<br>要 10 萬</div>
				<div class="sticky-note">PRP 增生療法<br>一個療程 15,000 元起跳</div>
			</div>
			<div class="horizontal-item">
				<img src="images/02.png" alt="Image 2">
			</div>
			<div class="horizontal-item">
				<img src="images/03.png" alt="Image 3">
			</div>
		</div>
	</div>

	<!-- Footer Sections -->
	<div class="vh-100 bg-white text-center footer-text" style="display:flex;justify-content:center;align-items:center;color:#333;font-size:1.5rem;padding:2rem;">
		從止痛藥到手術，慢性下背痛患者的醫療花費，沒有盡頭。
	</div>

	<!-- jQuery -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	
	<!-- Bootstrap 5 JS Bundle -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

	<script>
		$(function () {
			// ===== Progress Bar 圖片漸變效果 =====
			const $imageContainer = $(".image-transition-container");
			let imageContainerOffsetTop = 0;
			let imageContainerHeight = 0;
			const win_w = $(window).width();

			function updateImageContainerSizes() {
				imageContainerOffsetTop = $imageContainer.offset().top;
				imageContainerHeight = $imageContainer.outerHeight() - $(window).height();
			}

			updateImageContainerSizes();
			$(window).on("resize", function() {
				updateImageContainerSizes();
				updateSizes();
			});

			// ===== 正向水平捲動 (從左到右) =====
			const $scrollContainer = $(".scroll-container");
			const $horizontalSection = $(".horizontal-section");

			let containerOffsetTop = 0;
			let containerHeight = 0;

			function updateSizes() {
				containerOffsetTop = $scrollContainer.offset().top;
				containerHeight = $scrollContainer.outerHeight() - $(window).height();
			}

			updateSizes();

			$(window).on("scroll", function () {
				const scrolled = $(window).scrollTop();
				
				// ===== Progress Bar 寬度計算 (只在 image-transition-container 範圍內) =====
				if (scrolled > imageContainerOffsetTop && scrolled < imageContainerOffsetTop + imageContainerHeight) {
					const imageProgress = (scrolled - imageContainerOffsetTop) / imageContainerHeight;
					const new_width = win_w * imageProgress;
					$("#statusbar").css({ width: new_width });
				} else if (scrolled >= imageContainerOffsetTop + imageContainerHeight) {
					$("#statusbar").css({ width: win_w }); // 完全覆蓋
				} else {
					$("#statusbar").css({ width: 0 }); // 還沒開始
				}

				// ===== 水平捲動計算 =====
				let scrollPercentage = 0;

				// 計算在容器範圍內的捲動百分比
				if (scrolled > containerOffsetTop && scrolled < containerOffsetTop + containerHeight) {
					scrollPercentage = (scrolled - containerOffsetTop) / containerHeight;
				} else if (scrolled >= containerOffsetTop + containerHeight) {
					scrollPercentage = 1;
				}

				// 計算水平位移
				const maxScroll = $horizontalSection.outerWidth() - $(window).width();
				const horizontalScroll = scrollPercentage * maxScroll;

				$horizontalSection.css("transform", `translateX(-${horizontalScroll}px)`);

				// ===== 便條紙貼上效果 (from test.html) =====
				// 第一張圖片佔 0-0.25 的範圍，便條紙在 0-0.05 快速貼上（圖片還沒移動多少）
				if (scrollPercentage >= 0 && scrollPercentage <= 0.05) {
					const progress = scrollPercentage / 0.05;
					$('.sticky-note').each(function(index) {
						const threshold = (index + 1) / 10; // 10張便條紙
						if (progress >= threshold - 0.08) {
							$(this).addClass('visible');
						}
					});
				}
			});

			// ===== 導航列漢堡選單控制 =====
			$('.hamburger').on('click', function() {
				$(this).toggleClass('active');
				$('.nav-menu').toggleClass('active');
			});

			// 點擊導航連結後關閉選單
			$('.nav-link').on('click', function() {
				$('.hamburger').removeClass('active');
				$('.nav-menu').removeClass('active');
			});
		});
	</script>

</body>
</html>
